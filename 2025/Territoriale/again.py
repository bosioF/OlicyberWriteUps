from pwn import xor

SBOX = [23, 46, 93, 178, 209, 80, 169, 227, 246, 14, 79, 139, 196, 109, 176, 76, 188, 74, 163, 187, 130, 110, 101, 241, 202, 239, 53, 117, 114, 72, 131, 217, 71, 55, 253, 45, 212, 191, 59, 30, 104, 190, 251, 20, 94, 211, 84, 85, 68, 73, 237, 205, 174, 97, 197, 199, 36, 180, 100, 215, 107, 62, 89, 81, 111, 119, 32, 156, 214, 88, 183, 238, 18, 125, 231, 92, 127, 219, 138, 193, 141, 103, 37, 236, 157, 41, 158, 135, 120, 9, 250, 172, 106, 136, 2, 123, 247, 248, 26, 52, 54, 57, 204, 232, 7, 15, 140, 66, 245, 170, 144, 22, 203, 1, 56, 167, 34, 244, 137, 19, 225, 143, 6, 184, 10, 60, 151, 165, 91, 40, 133, 70, 128, 121, 220, 16, 152, 13, 58, 185, 254, 154, 198, 113, 160, 132, 206, 50, 122, 116, 192, 179, 153, 47, 95, 200, 112, 145, 5, 126, 105, 243, 164, 181, 146, 161, 129, 3, 48, 182, 189, 33, 148, 162, 69, 43, 234, 35, 39, 63, 150, 142, 61, 90, 64, 78, 42, 83, 21, 155, 168, 229, 96, 173, 208, 207, 221, 82, 242, 240, 27, 4, 186, 115, 17, 51, 159, 175, 75, 201, 44, 29, 218, 216, 108, 8, 99, 28, 102, 118, 24, 230, 195, 86, 226, 166, 11, 0, 171, 65, 228, 38, 223, 31, 67, 77, 49, 194, 124, 249, 222, 177, 252, 98, 235, 12, 210, 134, 233, 87, 255, 147, 149, 213, 25, 224]

SBOX_INV = [0] * 256
for i, val in enumerate(SBOX):
    SBOX_INV[val] = i

ciphertext = bytes.fromhex("ee734d61089099288a57c0b28156a0362ab6f96fc173131e3ec2d1ade029bcb24c1e110f4e77865772404d61f3909925464c17841e1e3e158ac8349ac07e411e08a79925464c17841e1e06c32625e029c1a9feadf215e6808a610c2cfec9f3a7eadbf9e30d9db6c94090d1adf9969fb29b1eccc226bb8756cda9fe7b110ffc99863a72f6297b3edfe7b7f9a523b39b7b0815c8b7f9c43acc29603370e87bb129ddb341d0080126c83778c07f9b92ff158ac86878a5b28d1e97c32b7a4629b97f1e7b1169992887c4feb2811e3e1599b6194c72848f074090eab64b570d841e58f30e9925468f3a214dfe40fbe77ab1c961cc2561ff9099adb1fe01848fad9715997ab186c17e411e8e0e2bc84656017ffe6d11a779b6bf9acda9fe60f20e74b62e4cc121ed1edc21e695b129cdbffe60a0159944865717844df3597057778661c12cfe4f3f03d1c8b1586bcc13a1e638747b19290c1bb6f35370547b2e5a72b24c6008fbe71f883072bdafac110f998e4a6192cc13a12515d128f95a231b51ad3e69997b86fecdcc4c6033152a28f9a20cb3136097152a25f9c9cd40b660976999b64a29bcb2be5633c32b77f958c184fe58f3cf74c887860ca9fef3ffdf4e77ea217a3c4dfe330e99b9b15a177f131e8e212b7b9ca5cda9fed03ec2d1adf95a231b1e6006c326adf9860d73305631cf8ac8349ac07e41f3409dc87a87c91784801effa7fcb6f96fc1841e1effc2d18e4a5717cc9b60adfc2a28ea29b88c41fe3ec22b7b1929cdbffe6ff33899adb1fe01848fad971580c88a9a0d2c4dfe40fbe77ab1c972739b074015d11f8a61037f297b403815284ac461cc62a13e03e71f46c97291b6433ea7e87b1429f9738d56f238798019290cb3417b4090d1adf9969fb29b1e1dc2261f886117dffed400cf79b64b9bc12cfe603f2179c8a8583a9de71e250e7444a85672b29b1ecc21e6ad9c61179d811e8e38fc778730727e414f3f0ee7adf99617cc3060f238fcdbf94717cc4c4f1d21e6adb1c97240bea13f0efcb746299f84e71eff70e77bb1c99f9d8f1eadcf79284629c17e9b610803d1b61929c1a9ed1e8a0e2b7a87fe17b21e58f30e99954b96a5bdb67b400e4e80142992849b1eff9de7adf94c23b39b4f3f702a7a4b969fbfaf61cc0ee6d1f96103cca3acffa7e8809c29cdb38dad40cf2b80bf9acd21ed1eebc3794487fe03841efe3e7026c88661927f1e1ef315992546c99273fe569715e7b7889a9fcc80ac3e3812b62e58722cb67b40cf74b69c29bcb24c1eadcf2ab7b1c961c4f6b53e019944b9960db29b61ff707977566117a9b6fe400e2b809c29cdcc80b13e90fc77193a72d39b56ff9d9999865a3acc3060f238fcd1f9a2cdbfb6ac0890d128f957ddb29b1ef238367b4b96721bafc9597012b64a863a739b1e3138eaad4ac472a94d61cc3879dbf9e30d7380fe3ea7fcc875780da9411e250fd1289c61347f801e9738797af9c90cbdfe6100214ebb4ac961cc5560317079809c29cd21807b40c3e61f46293a401eadad6399634ac9feb2296f089079b6f957ddb29b1ea021e8774b5792cc1e60ad69991f875a72b24d56a09dc8b9f961fe2c4df35370b97bb1c9347f801e3f38797b19293a401eadad6999438661a563b6acf2cf99b6565717cc30a13f382a28f9e73aa941605970e87775612f7f1e1e3ec3997ab1740cb3af0d40502a80196fc1b2fead2570e7289c29bc849ba13e702bb68a4cc12cfe43f2cf4eb9b14c72bfafc9efc3e7c84a4c72848f1e9738797aea29ab8430a1adc379c875560ca9b6adad70ea7b86c9c12cfe9211902ab6865761cc345eff90e77a4b9a92cc80b13e90fc771929c07f8d7bf390998075c9c121fea12570ea9914c423bdaf0d40bae77a4b57a5a980fe06c3e7c84a4c72b22956ad702a7a9c563abfb660a0702bb6a829cd7eb658f30efcc872570d2180c925c374c82e5701cc1e60317074774a563a2ced1e2e15997a46780db2807b4015e72575780dcc8156a0c379d1f9fe0cbffe61f315e67b1429bcb24c56257057994b9a1740417b400e2adbf913a5a980b13e0f990687c91784a3adf2c374d1f9780384af1e089d15b686583ab29b1e25384ebbb158c11b9b1ea0212b7ab15a3aa94d6f08a780c84b612fb2814f400ee6779c292f84a36097012a25f99b3a634dacff699977f9a532738160250f26c82e57347f801e31212b998629cdcc7560f23879dbf9e4c11b8d1e8e3857b68656cdcc4d7b40cf4ead8729cdbffe6d11a7e8801457a5a94df3537053b7465792b2297b4030e71f88560cb3b67b4090e7b9f958237eaf6140fc2b778a570d739b1ecc21e6ad463a7267806f4015d11f8a61037f297b40384ead8756037f131e33217425a85823dffe249715e7678756729d816d087079b614307240816025382a25f9fe0cbffec93e362ab6f9fe231be71eef0f2606b158cdcc4c4f1d21e6adb1c972b24c56256391c0349ac07e41f34001d1672e61922cb6f35970267b569a0ccc1e60317079b614a50cb3fe92110ffc77e02923b38d564015c8b79c780dcc8d4f97df2ab6f9583a73130740cfeac8b1fe17b2816ff39d99774a86c1b2fec9f3c22b77f96103cc4c4f3f0e74dbf9e30c7e4c609715e728bf9a0cccbea11d38fc772e4c7221af611d3899ad866192a9b658f30e992887fe0cbf9bada070e7adf9fe0ca94dfe400efcc81496c0b21eadff0126c872969fb21e1eff0399ad4a56fe841e1e3edfe7289c9692dffec5f2cf7928f996fea980c92570fc778a611784fefe1103d199196fc1cc416f40c2d1ada856cdcc9b4f3f362ab62e4c724080614003c81f4a743a73fec91190fcb746307240806140384ebb87a5179d1e1e003874b62e960c9d1e0d40402b80bf9acd21fe6d11a7e8801457a5a94df340012644b174c12cfe7bf30f1580193072b29b1e33217425a85823cc13564090c87a4b6101849bad31384ec83757c0dffe8ff33879c81978c07eb66d08152ab9b1fe72734c5606c3e7adf94c0d841e7b08362ab6ea29a97f81a11d38fc7b8629019d13f31101c8d1f957a584131eff7057b6194c3a914dacf39d9995b1740c1b8fadad69991fb1c9c0cc296006c3e7c89c563a2c9b5606c3e7c88861cd21e71ea038fcc846c40ca9fe953e0f74b62e4cc121fe7b3ec22b7b19290d841eada0704eb68a290c7eb67b5370f7adf99ac07e41f33321e64487567221b61effc3367b87307247b6c9082d2a28f9743a9180c931c374c87257c0841e1eccc226bb8756cda9fe58f33879dbf9b8c1841e1e06c3d128f9a20c7f5156ff159925469a0d841e0d4878087bb1c972a980f3cc21e6c84b5701a94dfe403815284ac46bcc294f9770c8b72e960db2fea1f3df2ab6f961a5a9806131c374c8463a72f6297b3edfe7b7f94c0d841e7b08362ab6f961a5a9806131c374c84b96017f1e0740cffcc84a9b17b3b66d080e79c87257c0841e0d40bae77a4b57a5a980fe06c3e7c837611773801ecbcfea804b6192841e1e110fea80e0290c7ffef3ff15fc80192923b38d56537086adb1969fcc9b60adfcc8b7f9c90c2172603f7026b78a9a7202b67bff0e99bba8c49f9d8f4f5370538846c90c7e4cada070d9b62e580db281562570267b8a4c23b3fe603f2179d1f99617ccb6c9250ee6b94ac4729d816d08639913869692cc4d7b400e1243b15a3aa94d614001d17714307202b67bff0e99774b61347f41f34021e6bbb13a7206bea1a00e2b7a4ac972739b1ef221e6b61429bc849ba13e70c8b78a617202805e08032a7a4629c17e4ca1ad03c8b775570dcc80b13e159906b14ccdb2fef3ffdf4e77ea29e39d296033704eb68a29fe9d1ead3e0fe7c887fe3a21ed1eebc3794487fe03841efe3e7074779c4c3a2cfe9508a7d1954ac972b22956ad702aadf9a523b39b7b0815c8b7ea29527fb6fe06c3e7c89c61a5bfb66ff3a7fcc8879a722c80f34090d1adf9969fb29b1e33c3e6284ac961ccc4c940cfeac8879b3aa9fea13370e8994b780dcc4dac250fd1bbb15792cc8d4f9790e78e4a9617dff6167aa799779c29ddb341d0080126c8146161cc346111384ec87557c07e80c9250e798e4a57724741ad3338c47b1929fe9d1ead3e0fe7dbf936178441f340fbe6802e863a7e4ca15970e680199a92cc4d7b40fbe77b5661cda9fe7b08a7ea80889aa5a9e71e2521e6ada856722141ad3f3879c8197803734c60a070261f9c576bcc807b4015e680194c3a8a4d604015c8b79c780dccaf6f082199b64a29c09d8160ad63991187c91784a3adf2c374c82e619284fec9082dd9d1f9c9cd63b67b253879c84a4c72734c5606c32625f9fe0cbfe71e3ec2e7807257a5bdfefe08159977145717cc8f4ff221e6dbf919c084b8adff9d99b6869617cc304ff2c3fc44464c61cc55603170ea7b86c9c12cfea19715e7c84a4c72b21e7b400e2bb6b1a20c1b8f0740cf9925469b0c2c4da131cf99b62e619fcc4dac250fd1bbb15792dffe0125382625f957c1cc4c4f3f0e74c8b158727eb6433e0fc8c8869a17b34df340cf2b80bf9a0ca9ed1e700e4eb646fe722141b8089d2a28f9c40ca94dfe40c3fcc819579fcc756108a736804b9bcdd5fe60f37074994b5792a9b660409d26672e96727eaf43110ffc80193a72fc4c5606c32625f9a20c7f5156ff159943879add84417b40be2a7a759a17739b605370547b4b9bcd21fe9211902ab6865772b29b1ea0cf158087fe72b25160257057b6194c3a914dacf39d8ac865960cbf80c9ff909977f996a5a9801e3ec2d1adea217a15b6d0ff9d2a28f957ddb21e7bff9099254686a573fef3ff907977e0290ca9fe43082de71f889a9fcc8061119099b6565792a941fe400efcdbf9b8c1841e1ea038fcc846c40ca9fe953e0f74b62e4cc121fec9082dd9dbf9d9c12c8d6040be2a7a759a17739b6040a72a7a4b96727e804f5970d11ff95ac1b31eada07057b64b6117cc4dacf2cf74bba856feb2811e25384ebbb158c11b9b0d40bae67787c90c1b9b1e33217425a85823cc35ada015c8c83757c0cc8fad087057994b9a1740417b402dd19587fe037f130d40bae77a4b57a5a980fe06c3e7c83757c0cc5161ffbed1b946290c2c9b07400e2ac872570d2180c925c374c82e619284ed1e8dc32b7a462992b213923e0f99b6867892cc416d4038744487560384807b40bee788b15ac17e410d40ecc8b7a461722c806f40c32b7a46c4019d81923e0f99034ac9179de71e8e0e2bc87569cdb3807b3fcf998e4a969fdff616dc21e695b129179d817b110f9999865a3ad5fe92110ffc77f9fe231bfefefffcd1b62e293abde71e250e74444ac972024dacccc3fc779c57721bb64300639959a8fe0cbffefe08159977145717cc416d33c3742846fe722c80f35970e767874c7221afac3e90fc808729cdb38dad537032b688293a2172603f01d1b69c29c0738dada070e680199a92d5fe5631702b778a61a584411ef238367b4b96727e414f3f0ee7adf99601dffeb53e0199774a5a179d811e06c32625f956c1a981adad6999bba8fe0384136097152a25f99bcdbf4dfe40cffcd1f956c1a981adad704e80196161cc25ad3fcfc4809c9a0dcc8f5633152a25f96103cc4c6033152a28f996727f4c7b3f38ea8087c961ccc64f3f0e74c8b1a5927f131e31212b99862992849b1eff9de7ade029019d29fe3e03fcb69c9a0dcc416f08fcd1288a61a563fe60f238fcdbf9b5cd7f8156a070fcb614a523b3e71eadcf79284629a59d291eadcf3f80149a92cc41ac08362ab69c30720280ac0815997aa8560c21fe56adfce7b788610ca9fe60e6699928875872b34d7b3fc374c81996fe8480c940c2e799f99601cc416133c38ac8c957a5b241c940fcc8b79c966bcc8061ff1599779c29019d296f089de71f9c9a9fcc8dad3f902a28e029927372563ea7991fb1c93acc13a12515d128f9fe0c8a4d605970e767874c727f4c7b3f38ea8087c9722c80f340362a7714290c7ffe6f08cf74dbf9190c1b80a19770e767874c72404dac8e384e778629c0b2af0740bed1ad4657722c80f3cc0ee6c88756232ced1e7aa799b69c29c1b329a1400e2ac8469add7f801ecc3026b7874c0d73fed008bee7b786967202b67bff0e9928b14c727313602570e77ab14c61c4f6d43ec22bb62e4c0c2cb8ad3e7012774a5a3a914dfe40a72a7a4b96722cb67b40cf74b69c2992b2131ef3c22b77145a23b372603f70e77a87c40c1b9badad6399638758722c806f40a7d1284b29c1a9fe603f2179c87569cdb3807b3fcf9944a8c9c1b28160400e36b69c2992b28f1ef238367b4b9661cc907b40902a288a61fe849b1e3ec2e7807257a5bdfe5e3ea7e8b787563aa9ed1ed1c3d128f9c9237e4c563338fc7b8861a5cc41ac08362a771429179d817b110f80c8464c722c4dfe333815809c29cdb38dad40dfe67737610373fe60ef0efcdbf9e30d7380fe3ea7fcc88a78a50241acf23879c87296c1bfb643f39099ad4a56fe841e074090e7b9f95a2321134f312199772e4c0ccc3060970e4e779c6192cc13a1f20e797b4658cddffe82ff0eeab62e9692cc75569738c47b1929b97f1e7b117057b64b292f84a36097012a25f99bcdbfb6c908cf8ac8689a3a2cfea12570c480a457a5bd4df3409de7ad4ac96bcc294f977012b686c40c1b9badad70e87bb13a72fc80c93ecf4ec87578927f80613e7074b69c9a92cc417b400e3fc84a9bc073136d110f15b68630720280ac400e36b6194ccd2cfe60a01599802e4c0cb38fadad6399f22e29fe7e416d3e0f26adf9c4cd6329a140bed1ad4657726381a18e38e877f94c0c2172ada0639959a8fe0cbffe43f2cf4eb9b14c6bcc1ea1cc38e71ff99601cc7560f3dfd1779c291784296d08012a1f9c30722141ad3f3879c89c780da9af61409dc87a87c91784801eff0fea7be029bc849ba13e70fc802e5a3abd4dc925702b778a9a92ccaf61333899b6565717cc4ca133c379dbf9e4c17e4ca1400e36b69c29fe9d817b2538fc998629bcb24c562569991f875a72b24c60ad0e4ead4ac4721bb6fef2639954469a0d841e1e3edfe7289c9692cc13a1f30fd128f9e73aa9416040c32bad866101b21e1ef2cfea802e61cddffe249715e767875672b24d1ead0efc7b1929bcb24c1eff0fea7bf9a5c0738d603fcffcc8759ac002b6c9ff0f8ac8689a3a2cfed03e90fc80a49ac07f131ef3c22b77145a23b372603f70747719c9cdcc29603370e76787c917731e0d4878a9b62e57cd1bfe6d11a757774b9b3a2cfe7bf30f15801929cda9fe60f238fcc84b782f9d817b089099bba8febc734cac08908ac8525703cc1ea1ef38fcadb1c972b29b1eadcf79284629a5b28d1ef2cfc8b7875717dffe82ffc3e680192923b329a13f0e997a465ac12cfefe3e9d80c82e78a5cc134ff20e79adb1577273297b3e702b778a61a584411e97214edbf9b5cd7f8156a070ea9914c423bdaf1e31c3d1c83757c0cc41adefc3e7c8879a3a2c134f3169998088292f7e41c93138fcc814617247416d08c2d128b1c961ccc4c9402d2b772e583aa9fec9082dd9c8149617a9b6fe597012b686c40c1b9badad7057b64b6117cc305625cfe7d1f974c073296f0815997a875a177f1e0d40bad9771957c07e4dfe40a7c81ff974c073296f081599ada856179d810d40bd2a7a4b969fcc417b40a72a1f8a290c7ffef30870ea992ec90c8a4da12570577b4ba5c1a9417b3e7026c8b1fe722c4192080e4edbf12142b22960ffa799ad87c4fe9d811effa7fcb6f96fc1841e1ead0efc7b19293a1b9b603f012a25e0293abdfefef390ea80756117cc3060f238fcc81496c0b21eadff0126dbf909c1841e58f30e991fa8fe7221b61e9738797aea29e39d29603370577b4ba5c1a9417b3e70747719c9cdcca3561d0e4eb94ac46bcc13a1f20e797b4658cdcc1356400e36b69c307202805e08032a7a4629cd1b9b60537053b64b9b0c1b9b60a0362ab6f94c3a1b8d5631c34eadf9c4cd7f8156a07079809c29cd21807b400ee6779c29038451c9089079801429cd7eb658f3cf74dbf9f20d731e1e250e7444a8566bcc41c9250e9928b14c727313602570578037570db3411effc3eaada8566bccb692a0c374c84b780db2131ef2cfea802e61cdcc29adf2c226d1f9c93aa9fea1ad0efcc8b1c4feb2816f080efcc81496dd1b411e31382625f99617cc4c561d0ee699ea29b88c41fe3ec22b7b1929929d4cac0803d1ad4a583a1bfed03ec299b9a89b23b3fe602570ea992ee7cd7e4c56a0639963875872a9af612521e6c84656017fe71e33214e28875a17b29bad3f702aadf956329d296df39099b64a3072b24d56a09dc8b9f99672b24c5625639959a8fe0cbffea13370e7b7464c72a9af612521e6dbf9b8c1841e1ef3c22b77145a23b372603f69998075c9c121fed0081526b6f99ac07e41f33321e6448756722c4dfe333815809c3072bdb6a1ad704e7b2e5a72bdb66d25c374c8878f6bcc807b40dfe67737610373fea1f3df2ab6f9fe3a91be1eff15997a877861cc2760a015d1954a9bc121fea19715e7c8b1a5927f131ecc0fd125b1c97284291ecbcf2abbb174c12cfe4f3f03d1c84b9a01a94dfe400efcc84a9b17b3b66d3e909944a8c9c1b2816040032a95b19b3a73fe6df30f26b669296da9b6a1ad702aadf9a20d8429b108c22b77f99b3a918061116999bba8fedd7f801e3138361fb1c99284131ef238c4b6867861cc62a1f30fd128f957ddb29b1ea0cf158087fe7284291effa7fcb6f94c0c21724f3f7015b64b9b0c1b9b60a0362ab6f9c90cbdfea12570747756fecddffe2e3ea7e7772e29019d13f31101c8d1f958c184fefe08159977145717cc756108a736804b9bcdcc30600038ea7b4b966bcc9bad3ffcd128f94c0c7e4cada07079998896c0b21e1e8bc379ada830728a4d56a0701599864c17849b4f3f70fc99864c23b3fe60a015998e4a6192cc4c56efc32b77ea29b8b24cac3ea7fcb6196fc1b2fec911a79943879add84417b40a72a7a4b966bcc305625cfe7c85656cd02b66fff704e80199b61c4f6d3ff9d9944879bc0b2297b3e90df7b8729bcb21e7b082d2a7a4ac4721b4dacf2cf99808829c17e9b610803e728ea29b8b34160a00e4eadf9c4237e4c56a0704e7b2e5a722c4192080e4ed1f99a17cc4c4f1d21e6adb1c9729d816d0870c480a457a5bd4df340384edbf9b8c1841e1e8e0e2bc8879b0c2180c925c374c89c9a0d40b6fe537008992e5701cc4ca1110fe7b69c290c1bb6f340cfeac8146172734c5606c3e7adf9619f4080613138e7adea29d9b28f1effa7fcb6f9fe3a2cb6074003c81f1957347f417b400efcc88896fe84a3ada070157a465a0cb3417b5970d11f9c570dbd4df340cffcc84b96017f1e0d40bd2a7a4b969fcc4d7b4003c81f88619fb2297bf39d99254686a573ed53cb0f138e4aa3a5bf3622ffa7707a310fbaeac295c024a595884af266759c1d")

x = 0

for key_length in range(6, 13):  # Lunghezza chiave da 6 a 12
    for key in range(2 ** (key_length * 8)):  
        key_bytes = key.to_bytes(key_length, 'big')
        plaintext_substituted = xor(ciphertext, key_bytes)
        print(x)

        try:
            plaintext = bytes([SBOX_INV[x] for x in plaintext_substituted])
            x += 1
            if b"flag{" in plaintext: 
                print("Chiave trovata:", key_bytes.hex())
                print("Testo originale:", plaintext.decode())
                break
        except:
            continue
